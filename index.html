<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <!-- Removi maximum-scale / user-scalable para melhorar acessibilidade -->
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>As Brutas - Delivery Oficial</title>

  <!-- Estilos -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- React (produção UMD) e ReactDOM (produção UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel para JSX no cliente (bom para protótipo / single file) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #0f172a;
      color: #f1f5f9;
    }
    h1, h2, h3, h4, .font-display {
      font-family: 'Oswald', sans-serif;
    }
    .scroll-hidden::-webkit-scrollbar {
      display: none;
    }
    .scroll-hidden {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    .animate-slide-up {
      animation: slideUp 0.3s ease-out forwards;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #eab308 !important;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef } = React;
    const { createRoot } = ReactDOM;

    // --- CONSTANTES E DADOS ---
    const PHONE_NUMBER = "556798036326"; // ajustar se necessário (DDI+DDD+numero sem +)
    const DELIVERY_FEE = 7.00;

    const MENU_DATA = [
      {
        category: "Os Clássicos",
        icon: "fa-star",
        items: [
          { id: 1, name: "X-Burguer", desc: "Hambúrguer, presunto, mussarela e molho especial.", price: 15.00 },
          { id: 2, name: "X-Salada", desc: "Hambúrguer, presunto, mussarela, alface, tomate, milho e molho.", price: 18.00 },
          { id: 3, name: "X-Dogão", desc: "Salsicha, presunto, mussarela, ovo, batata, salada, milho.", price: 19.00 },
          { id: 4, name: "X-Egg", desc: "Hambúrguer, ovo, presunto, mussarela, salada, milho.", price: 20.00 },
          { id: 5, name: "X-Frango", desc: "Frango, hambúrguer, presunto, mussarela, salada, milho.", price: 21.00 },
          { id: 6, name: "X-Calabresa", desc: "Calabresa, hambúrguer, presunto, mussarela, salada, milho.", price: 22.00 }
        ]
      },
      {
        category: "Especiais",
        icon: "fa-fire",
        items: [
          { id: 7, name: "X-Baguncinha", desc: "Bacon, calabresa, salsicha, frango, ovo, batata, presunto, mussarela, salada.", price: 27.00, tag: "TOP" },
          { id: 8, name: "X-Calabacon", desc: "Hambúrguer, calabresa, bacon, presunto, mussarela, salada.", price: 25.00 },
          { id: 9, name: "X-Bacon", desc: "Hambúrguer, bacon, presunto, mussarela, salada e molho.", price: 22.00 },
          { id: 10, name: "X-NAS", desc: "Filé de carne, hambúrguer, presunto, mussarela, salada.", price: 28.00 },
          { id: 11, name: "X-Costela", desc: "Costela, hambúrguer, ovo, presunto, mussarela, salada.", price: 25.00 },
          { id: 12, name: "X-Strogonoff", desc: "Hambúrguer, strogonoff (Carne/Frango), batata, presunto, mussarela, salada.", price: 22.00 }
        ]
      },
      {
        category: "Gigantes",
        icon: "fa-layer-group",
        items: [
          { id: 13, name: "X-Tudo", desc: "Frango, burger, calabresa, bacon, salsicha, ovo, batata, queijo, presunto.", price: 30.00 },
          { id: 14, name: "X-Egg Duplo", desc: "2 burgers, 2 ovos, 2 salsichas, presunto, mussarela, salada.", price: 26.00 },
          { id: 15, name: "X-Triplo Monstro", desc: "3 hambúrgueres, 3 ovos, 3 presuntos, 3 mussarelas, salada.", price: 35.00, tag: "Monstro" }
        ]
      },
      {
        category: "Bebidas",
        icon: "fa-wine-bottle",
        items: [
          { id: 16, name: "Coca-Cola 2L", desc: "Garrafa 2 Litros", price: 14.00 },
          { id: 17, name: "Coca-Cola 1,5L", desc: "Garrafa 1.5 Litros", price: 9.00 },
          { id: 18, name: "Coca-Cola 600ML", desc: "Garrafa 600ml", price: 6.00 },
          { id: 19, name: "Coca-Cola Lata Mini", desc: "Lata Mini 220ml", price: 3.50 },
          { id: 20, name: "Fanta Laranja 2L", desc: "Garrafa 2 Litros", price: 12.00 },
          { id: 21, name: "Funada 2L", desc: "Garrafa 2 Litros", price: 10.00 },
          { id: 22, name: "Cerveja Lata", desc: "Unidade", price: 5.00 },
          { id: 23, name: "Vinho", desc: "Garrafa", price: 25.00 },
          { id: 24, name: "Vodka", desc: "Unidade", price: 20.00 },
          { id: 25, name: "Energético 2L", desc: "Garrafa 2 Litros", price: 15.00 },
          { id: 26, name: "Suco Ades", desc: "Unidade", price: 6.00 }
        ]
      },
      {
        category: "Doces e Diversos",
        icon: "fa-cookie",
        items: [
          { id: 30, name: "Paçoquinha", desc: "Unidade", price: 2.00 },
          { id: 31, name: "Cocada", desc: "Unidade", price: 2.00 },
          { id: 32, name: "Suspiro", desc: "Unidade", price: 2.00 },
          { id: 33, name: "Maria Mole", desc: "Unidade", price: 2.00 },
          { id: 34, name: "Pirulito", desc: "Unidade", price: 2.00 },
          { id: 35, name: "Halls", desc: "Unidade", price: 4.00 },
          { id: 36, name: "Trident", desc: "Unidade", price: 4.00 }
        ]
      }
    ];

    // --- COMPONENTES AUXILIARES ---
    const Header = ({ categories, activeCategory, setActiveCategory }) => {
      const handleCategoryClick = (idx) => {
        setActiveCategory(idx);
        const element = document.getElementById(`cat-${idx}`);
        if (element) {
          const headerOffset = 140;
          const elementPosition = element.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
          window.scrollTo({ top: offsetPosition, behavior: "smooth" });
        }
      };
      return (
        <header className="bg-slate-900/90 backdrop-blur-md border-b border-slate-800 sticky top-0 z-50 shadow-xl">
          <div className="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <div className="flex items-center gap-3">
              <div className="bg-yellow-500 w-11 h-11 rounded-xl flex items-center justify-center text-slate-900 rotate-3 shadow-lg">
                <i className="fas fa-hamburger text-2xl" aria-hidden="true"></i>
              </div>
              <div>
                <h1 className="text-2xl font-display font-bold uppercase text-white leading-none">As Brutas</h1>
                <p className="text-[10px] text-yellow-500 font-bold tracking-widest mt-1 uppercase">Burger & Drinks</p>
              </div>
            </div>
          </div>
          <nav className="max-w-4xl mx-auto px-4 py-2 overflow-x-auto whitespace-nowrap scroll-hidden" aria-label="Categorias">
            <div className="flex space-x-2">
              {categories.map((cat, idx) => (
                <button
                  key={cat.category}
                  onClick={() => handleCategoryClick(idx)}
                  className={`px-5 py-2 rounded-full text-xs font-bold uppercase transition-all border ${
                    activeCategory === idx 
                      ? 'bg-yellow-500 text-slate-900 border-yellow-500 shadow-lg shadow-yellow-500/10' 
                      : 'bg-slate-800 text-slate-400 border-slate-700'
                  }`}
                >
                  {cat.category}
                </button>
              ))}
            </div>
          </nav>
        </header>
      );
    };

    const ProductCard = ({ item, quantity, onUpdateQty }) => {
      const formatPrice = (p) => p.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
      return (
        <div className={`bg-slate-800 p-5 rounded-2xl border transition-all duration-300 ${
          quantity > 0 ? 'border-yellow-500 ring-1 ring-yellow-500/20' : 'border-slate-700'
        }`}>
          <div className="flex justify-between items-start mb-4">
            <div className="flex-1 pr-2">
              <h4 className="text-xl font-display font-bold text-white leading-tight">{item.name}</h4>
              <p className="text-slate-400 text-sm mt-1">{item.desc}</p>
            </div>
            <span className="text-xl font-bold text-yellow-500 whitespace-nowrap">{formatPrice(item.price)}</span>
          </div>
          <div className="flex items-center justify-between mt-4 pt-4 border-t border-slate-700/50">
            <span className="text-[10px] font-bold text-yellow-500 uppercase tracking-widest">
              {quantity > 0 ? 'Na Sacola' : ''}
            </span>
            <div className="flex items-center bg-slate-900 rounded-xl p-1 border border-slate-700" role="group" aria-label={`Quantidade de ${item.name}`}>
              <button aria-label={`Diminuir ${item.name}`} onClick={() => onUpdateQty(item, -1)} disabled={quantity === 0} className="w-10 h-10 text-red-400 hover:bg-red-400/10 rounded-lg transition-colors flex items-center justify-center">
                <i className="fas fa-minus" aria-hidden="true"></i>
              </button>
              <span className="w-8 text-center font-bold text-lg text-white">{quantity}</span>
              <button aria-label={`Adicionar ${item.name}`} onClick={() => onUpdateQty(item, 1)} className="w-10 h-10 text-green-400 hover:bg-green-400/10 rounded-lg transition-colors flex items-center justify-center">
                <i className="fas fa-plus" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>
      );
    };

    const FloatingCart = ({ count, total, onClick }) => {
      if (count === 0) return null;
      return (
        <div className="fixed bottom-6 left-4 right-4 z-40 max-w-4xl mx-auto">
          <button onClick={onClick} className="w-full bg-yellow-500 text-slate-900 rounded-2xl p-4 flex justify-between items-center shadow-[0_20px_50px_rgba(234,179,8,0.3)] ring-4 ring-yellow-500/20 transition-transform active:scale-95" aria-label="Ver sacola">
            <div className="flex items-center gap-4">
              <div className="bg-slate-900 w-12 h-12 rounded-xl flex items-center justify-center font-black text-yellow-500 text-xl">{count}</div>
              <div className="text-left">
                <p className="text-[10px] font-black uppercase tracking-tighter opacity-70 leading-none">Total na Sacola</p>
                <span className="text-xl font-black">{total.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })}</span>
              </div>
            </div>
            <span className="font-black uppercase text-xs tracking-widest bg-slate-900 text-yellow-500 px-6 py-3 rounded-xl">Ver Sacola</span>
          </button>
        </div>
      );
    };

    const AISuggestion = ({ cartItems, onAdd }) => {
      const [suggestion, setSuggestion] = useState(null);
      useEffect(() => {
        if (cartItems.length === 0) {
          setSuggestion(null);
          return;
        }
        const hasDrinks = cartItems.some(i => i.id >= 16 && i.id <= 26);
        if (!hasDrinks) {
          const allDrinks = MENU_DATA.find(c => c.category === "Bebidas")?.items || [];
          setSuggestion(allDrinks[0] || null);
        } else {
          setSuggestion(null);
        }
      }, [cartItems]);

      if (!suggestion) return null;
      return (
        <div className="bg-slate-800/40 border-2 border-dashed border-yellow-500/30 rounded-2xl p-5 mb-8 flex flex-col sm:flex-row items-center justify-between gap-4">
          <div className="flex items-center gap-4 text-sm">
            <div className="w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center text-yellow-500 shrink-0">
              <i className="fas fa-magic" aria-hidden="true"></i>
            </div>
            <p className="text-white">Que tal uma <span className="text-yellow-500 font-bold">{suggestion.name}</span> para acompanhar?</p>
          </div>
          <button onClick={() => onAdd(suggestion, 1)} className="bg-yellow-500 text-slate-900 px-6 py-2 rounded-xl text-xs font-black uppercase shadow-lg shadow-yellow-500/20 whitespace-nowrap">Adicionar</button>
        </div>
      );
    };

    const CartDrawer = ({ items, total, onClose, onUpdateQty, orderDetails, setOrderDetails, onFinalize }) => {
      const formatPrice = (p) => p.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
      const finalTotal = total + DELIVERY_FEE;
      return (
        <div className="fixed inset-0 z-[100] flex flex-col" role="dialog" aria-modal="true" aria-label="Sacola de compras">
          <div className="absolute inset-0 bg-slate-950/95 backdrop-blur-md" onClick={onClose} />
          <div className="relative bg-slate-900 w-full h-full max-w-xl mx-auto flex flex-col animate-slide-up shadow-2xl border-x border-slate-800">
            <div className="p-5 border-b border-slate-800 flex justify-between items-center bg-slate-900/50 backdrop-blur-sm sticky top-0 z-10">
              <h3 className="text-2xl font-display font-bold text-white uppercase tracking-wider">Sua Sacola</h3>
              <button onClick={onClose} className="bg-slate-800 text-slate-400 w-10 h-10 rounded-full flex items-center justify-center" aria-label="Fechar sacola"><i className="fas fa-times" aria-hidden="true"></i></button>
            </div>
            
            <div className="flex-grow overflow-y-auto p-6 space-y-8 scroll-hidden pb-40">
              <div className="space-y-3">
                {items.length === 0 && <p className="text-slate-400">Sua sacola está vazia.</p>}
                {items.map(item => (
                  <div key={item.id} className="flex items-center gap-4 p-4 bg-slate-800/50 rounded-2xl border border-slate-800">
                    <div className="flex-grow">
                      <h4 className="font-bold text-white leading-tight">{item.name}</h4>
                      <p className="text-xs text-slate-500">{formatPrice(item.price)}</p>
                    </div>
                    <div className="flex items-center bg-slate-900 rounded-lg p-1 border border-slate-700" role="group" aria-label={`Quantidade de ${item.name}`}>
                      <button aria-label={`Diminuir ${item.name}`} onClick={() => onUpdateQty(item, -1)} className="w-8 h-8 text-red-400 flex items-center justify-center"><i className="fas fa-minus text-xs" aria-hidden="true"></i></button>
                      <span className="w-8 text-center font-bold text-white text-sm">{item.quantity}</span>
                      <button aria-label={`Adicionar ${item.name}`} onClick={() => onUpdateQty(item, 1)} className="w-8 h-8 text-green-400 flex items-center justify-center"><i className="fas fa-plus text-xs" aria-hidden="true"></i></button>
                    </div>
                  </div>
                ))}
              </div>

              <div className="bg-slate-800 p-6 rounded-2xl space-y-3 border border-slate-700 shadow-xl">
                <div className="flex justify-between text-slate-400 text-sm"><span>Subtotal</span><span>{formatPrice(total)}</span></div>
                <div className="flex justify-between text-yellow-500 font-bold text-sm"><span>Taxa de Entrega</span><span>{formatPrice(DELIVERY_FEE)}</span></div>
                <div className="pt-4 border-t border-slate-700 flex justify-between items-center">
                  <span className="text-xl font-bold text-white uppercase font-display tracking-widest">Total</span>
                  <span className="text-3xl font-black text-yellow-500 font-display tracking-tighter">{formatPrice(finalTotal)}</span>
                </div>
              </div>

              <div className="space-y-5">
                <h4 className="text-sm font-bold uppercase text-slate-500 tracking-widest flex items-center gap-2 px-1">
                  <i className="fas fa-map-marker-alt text-yellow-500" aria-hidden="true"></i> Onde Entregar?
                </h4>
                <input 
                  type="text" placeholder="Seu Nome Completo" value={orderDetails.clientName}
                  onChange={e => setOrderDetails(prev => ({ ...prev, clientName: e.target.value }))}
                  className="w-full bg-slate-800 border border-slate-700 rounded-2xl p-4 text-white text-sm focus:ring-2 focus:ring-yellow-500/50"
                  aria-label="Seu nome completo"
                />
                <textarea 
                  placeholder="Endereço (Rua, Nº, Bairro, Referência)" value={orderDetails.address}
                  onChange={e => setOrderDetails(prev => ({ ...prev, address: e.target.value }))}
                  className="w-full bg-slate-800 border border-slate-700 rounded-2xl p-4 text-white text-sm resize-none focus:ring-2 focus:ring-yellow-500/50" rows={3}
                  aria-label="Endereço de entrega"
                />
                <div className="space-y-3">
                  <p className="text-[10px] font-black uppercase text-slate-500 px-1">Forma de Pagamento</p>
                  <div className="grid grid-cols-3 gap-2">
                    {['Pix', 'Cartão', 'Dinheiro'].map(method => (
                      <button
                        key={method}
                        onClick={() => setOrderDetails(prev => ({ ...prev, paymentMethod: method }))}
                        className={`py-3 rounded-xl border text-xs font-bold transition-all ${
                          orderDetails.paymentMethod === method ? 'bg-yellow-500 text-slate-900 border-yellow-500 shadow-lg' : 'bg-slate-800 text-slate-500 border-slate-700'
                        }`}
                        aria-pressed={orderDetails.paymentMethod === method}
                      >
                        {method}
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            </div>

            <div className="p-5 bg-slate-900 border-t border-slate-800 shadow-[0_-10px_30px_rgba(0,0,0,0.3)]">
              <button onClick={onFinalize} className="w-full bg-green-600 hover:bg-green-500 py-5 rounded-2xl text-white font-black uppercase text-lg flex justify-center items-center gap-4 shadow-xl transition-all active:scale-95" aria-label="Enviar pedido via WhatsApp">
                <span>Enviar no WhatsApp</span>
                <i className="fab fa-whatsapp text-2xl" aria-hidden="true"></i>
              </button>
              <p className="text-[10px] text-center text-slate-600 mt-3 font-bold uppercase tracking-widest">Pedido Seguro via WhatsApp</p>
            </div>
          </div>
        </div>
      );
    };

    // --- COMPONENTE PRINCIPAL (APP) ---
    const App = () => {
      const [cart, setCart] = useState(() => {
        try {
          const raw = localStorage.getItem('asbrutas_cart_v1') || '{}';
          return JSON.parse(raw);
        } catch (e) {
          return {};
        }
      });
      const [isCartOpen, setIsCartOpen] = useState(false);
      const [activeCategory, setActiveCategory] = useState(0);
      const [orderDetails, setOrderDetails] = useState({ clientName: '', address: '', paymentMethod: 'Pix' });

      // Save cart to localStorage when it changes
      useEffect(() => {
        try {
          localStorage.setItem('asbrutas_cart_v1', JSON.stringify(cart));
        } catch (e) {
          // ignore localStorage errors
        }
      }, [cart]);

      const onUpdateQty = (item, delta) => {
        setCart(prev => {
          const copy = { ...prev };
          const key = String(item.id);
          const currentQty = copy[key]?.quantity || 0;
          const nextQty = Math.max(0, currentQty + delta);
          if (nextQty === 0) {
            delete copy[key];
          } else {
            copy[key] = { id: item.id, name: item.name, price: item.price, quantity: nextQty };
          }
          return copy;
        });
      };

      const onAdd = (item, quantity = 1) => {
        setCart(prev => {
          const copy = { ...prev };
          const key = String(item.id);
          const currentQty = copy[key]?.quantity || 0;
          copy[key] = { id: item.id, name: item.name, price: item.price, quantity: currentQty + quantity };
          return copy;
        });
      };

      const cartItems = useMemo(() => Object.values(cart), [cart]);

      const itemCount = cartItems.reduce((s, i) => s + i.quantity, 0);
      const subtotal = cartItems.reduce((s, i) => s + i.quantity * i.price, 0);

      const openCart = () => setIsCartOpen(true);
      const closeCart = () => setIsCartOpen(false);

      const validateOrder = () => {
        if (cartItems.length === 0) {
          return "Sua sacola está vazia.";
        }
        if (!orderDetails.clientName.trim()) {
          return "Por favor informe seu nome.";
        }
        if (!orderDetails.address.trim()) {
          return "Por favor informe o endereço de entrega.";
        }
        return null;
      };

      const onFinalize = () => {
        const err = validateOrder();
        if (err) {
          alert(err);
          return;
        }

        // Montar mensagem do WhatsApp
        const formatPrice = (p) => p.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
        let text = `*Pedido — As Brutas*%0A%0A`;
        cartItems.forEach(it => {
          const line = `${it.quantity}x ${it.name} — ${formatPrice(it.price)}%0A`;
          text += line;
        });
        text += `%0A*Subtotal:* ${formatPrice(subtotal)}%0A`;
        text += `*Entrega:* ${formatPrice(DELIVERY_FEE)}%0A`;
        text += `*Total:* ${formatPrice(subtotal + DELIVERY_FEE)}%0A%0A`;
        text += `*Pagamento:* ${orderDetails.paymentMethod}%0A`;
        text += `*Nome:* ${orderDetails.clientName}%0A`;
        text += `*Endereço:* ${orderDetails.address}%0A%0A`;
        text += `Envio via app`;

        const encoded = encodeURIComponent(text);
        const url = `https://wa.me/${PHONE_NUMBER}?text=${encoded}`;

        // Abrir em nova aba
        window.open(url, '_blank');
      };

      return (
        <div className="min-h-screen">
          <Header categories={MENU_DATA} activeCategory={activeCategory} setActiveCategory={setActiveCategory} />

          <main className="max-w-4xl mx-auto p-4 pb-40">
            <section className="mt-6 space-y-10">
              {MENU_DATA.map((cat, idx) => (
                <div id={`cat-${idx}`} key={cat.category}>
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-2xl font-display font-bold text-white">{cat.category}</h2>
                    <span className="text-sm text-slate-400 uppercase tracking-widest">{cat.items.length} itens</span>
                  </div>

                  <AISuggestion cartItems={cartItems} onAdd={onAdd} />

                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {cat.items.map(item => (
                      <ProductCard
                        key={item.id}
                        item={item}
                        quantity={cart[String(item.id)]?.quantity || 0}
                        onUpdateQty={onUpdateQty}
                      />
                    ))}
                  </div>
                </div>
              ))}
            </section>
          </main>

          <FloatingCart count={itemCount} total={subtotal + DELIVERY_FEE} onClick={openCart} />

          {isCartOpen && (
            <CartDrawer
              items={cartItems}
              total={subtotal}
              onClose={closeCart}
              onUpdateQty={(item, delta) => {
                onUpdateQty(item, delta);
              }}
              orderDetails={orderDetails}
              setOrderDetails={setOrderDetails}
              onFinalize={onFinalize}
            />
          )}
        </div>
      );
    };

    // Render
    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
